# Template file for 'matrix-mirage'
pkgname=matrix-mirage
version=0.6.0
revision=1
wrksrc="mirage-${version}"
build_style=qmake
hostmakedepends="python3-setuptools qt5-qmake qt5-quickcontrols2-devel qt5-declarative-devel"
makedepends="qt5-quickcontrols2-devel qt5-declarative-devel libXScrnSaver-devel"
depends="python3 python3-Pillow python3-aiofiles python3-appdirs python3-blist python3-filetype
 python3-html-sanitizer python3-lxml python3-matrix-nio python3-mistune python3-pymediainfo
 python3-pyotherside python3-peewee python3-CairoSVG qt5-graphicaleffects"
short_desc="Qt/QML+Python Matrix client for encrypted and decentralized chat"
maintainer="Franc[e]sco <lolisamurai@tfwno.gf>"
license="GPL-3.0-or-later"
homepage="https://github.com/mirukana/mirage"
_hsluv_commit=9e9be32d6010cad484a7b12b1a3d19c6cf4c1353
distfiles="https://github.com/mirukana/mirage/archive/v${version}.tar.gz
 https://github.com/hsluv/hsluv-c/archive/${_hsluv_commit}.tar.gz"
checksum="8dee7a54b58ee244203b2e2c4a52596459f52afcd5f596af4cc614d9a8d1402f
 73bbdcec587339d6b385ab2da4d43d486db578b2521a9b527d2ac9110f5000c1"

post_extract() {
	mv "${XBPS_BUILDDIR}/hsluv-c-${_hsluv_commit}/"* submodules/hsluv-c/
	# binary name conflicts with mirage the image viewer
	sed -i 's/TARGET[[:space:]]*=[[:space:]]*mirage/TARGET = matrix-mirage/g' mirage.pro
	sed -i 's/Exec=mirage/Exec=matrix-mirage/g' extra/linux/mirage.desktop
}
